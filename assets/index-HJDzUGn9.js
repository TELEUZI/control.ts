var $=Object.defineProperty;var P=(s,e,t)=>e in s?$(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>(P(s,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function O(s){return s!=null}class h{constructor(e,...t){c(this,"node");c(this,"children",[]);e.txt&&(e.textContent=e.txt);const o=document.createElement(e.tag??"div");Object.assign(o,e),this.node=o,t.length>0&&this.appendChildren(t)}append(e){e instanceof h?(this.children.push(e),this.node.append(e.getNode())):this.node.append(e)}appendChildren(e){e.filter(O).forEach(t=>{this.append(t)})}setTextContent(e){this.node.textContent=e}getNode(){return this.node}addClass(e){this.node.classList.add(e)}toggleClass(e,t){this.node.classList.toggle(e,t)}removeClass(e){this.node.classList.remove(e)}destroyChildren(){this.children.forEach(e=>{e.destroy()}),this.children.length=0}destroy(){this.destroyChildren(),this.node.remove()}}function z(s,e){return new h(s,...e)}function m(s){return(e={},...t)=>z({...e,tag:s},t)}const E=m("span"),A=m("main"),F=m("label"),T=m("input"),R=m("h1"),C=m("h2"),D=m("h3"),i=m("div"),N=m("a"),B=m("img"),W="modulepreload",K=function(s){return"/control.ts/"+s},M={},V=function(e,t,o){let n=Promise.resolve();if(t&&t.length>0){const r=document.getElementsByTagName("link");n=Promise.all(t.map(a=>{if(a=K(a),a in M)return;M[a]=!0;const d=a.endsWith(".css"),x=d?'[rel="stylesheet"]':"";if(!!o)for(let p=r.length-1;p>=0;p--){const f=r[p];if(f.href===a&&(!d||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${x}`))return;const u=document.createElement("link");if(u.rel=d?"stylesheet":W,d||(u.as="script",u.crossOrigin=""),u.href=a,document.head.appendChild(u),d)return new Promise((p,f)=>{u.addEventListener("load",p),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${a}`)))})}))}return n.then(()=>e()).catch(r=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r})};class j{constructor(e){this.storageKeyPrefix=e}getStorageKey(e){return`${this.storageKeyPrefix}_${e}`}saveData(e,t){const o=this.getStorageKey(e.toString());localStorage.setItem(o,JSON.stringify(t))}getData(e,t){const o=this.getStorageKey(e.toString()),n=localStorage.getItem(o);if(n===null)return null;try{const r=JSON.parse(n);return t?t(r)?r:null:r}catch(r){return console.error("Error parsing JSON:",r),null}}clearStorage(){localStorage.clear()}}const H=new j("movie-app");class U{constructor(e){this.localStorageService=e}async getMovies({page:e,limit:t},o){const n=this.getPersistentFavoriteMovies();return V(()=>import("./movies-s7jDMuIN.js"),__vite__mapDeps([])).then(r=>{const a=o?r.movies.filter(d=>n.includes(d.kinopoiskId.toString())):r.movies;return{data:a.slice((e-1)*t,e*t).map(d=>({...d,isFavorite:n.includes(d.kinopoiskId.toString())})),total:a.length,hasMore:e*t<a.length}})}getPersistentFavoriteMovies(){return this.localStorageService.getData("favoriteMovies",Array.isArray)??[]}updateFavoriteMovies(e){const t=this.getPersistentFavoriteMovies(),o=t.indexOf(e);o!==-1?t.splice(o,1):t.push(e),this.localStorageService.saveData("favoriteMovies",t)}}const G=new U(H),J="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20552.85%20198.67'%3e%3ctitle%3ers_school%3c/title%3e%3cg%20data-name='Layer%202'%3e%3cg%20data-name='Layer%201'%3e%3cpath%20d='M275.36%2061.37l26.29-1.65q.86%206.41%203.48%209.76%204.28%205.43%2012.2%205.43%205.91%200%209.12-2.77a8.34%208.34%200%200%200%203.2-6.44%208.18%208.18%200%200%200-3-6.22q-3-2.74-14.15-5.19-18.18-4.08-25.93-10.86a21.84%2021.84%200%200%201-7.81-17.26%2023.44%2023.44%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26.05%201.52q-1-6-4.36-8.78t-9.2-2.77c-3.21%200-5.63.69-7.25%202.05a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.84q1.95%201.77%209.27%203.3%2018.12%203.9%2026%207.9t11.4%209.91a25.12%2025.12%200%200%201%203.57%2013.24%2028.37%2028.37%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78t-10-22.35zM6.27%2091V1.53h46.06q12.81%200%2019.58%202.19a20.93%2020.93%200%200%201%2010.92%208.14A24.75%2024.75%200%200%201%2087%2026.35a24.8%2024.8%200%200%201-3.2%2012.84A24.91%2024.91%200%200%201%2075.07%2048a33.63%2033.63%200%200%201-9.7%203.54%2027.79%2027.79%200%200%201%207.19%203.29A27.79%2027.79%200%200%201%2077%2059.49%2035.16%2035.16%200%200%201%2080.85%2065l13.38%2026H63L48.24%2063.63q-2.81-5.31-5-6.9a11.63%2011.63%200%200%200-6.78-2.07H34V91zM34%2037.76h11.68A41%2041%200%200%200%2053%2036.54a7.3%207.3%200%200%200%204.48-2.81%208.24%208.24%200%200%200%201.74-5.18%208.23%208.23%200%200%200-2.75-6.65q-2.74-2.32-10.31-2.32H34zM0%20167.56l26.29-1.64q.86%206.41%203.48%209.76Q34%20181.11%2042%20181.11q5.91%200%209.12-2.78a8.34%208.34%200%200%200%203.2-6.44%208.2%208.2%200%200%200-3-6.22q-3-2.74-14.15-5.18-18.18-4.1-25.93-10.86a21.87%2021.87%200%200%201-7.81-17.27%2023.49%2023.49%200%200%201%204-13%2026.47%2026.47%200%200%201%2012-9.64q8-3.51%2022-3.51%2017.14%200%2026.14%206.38t10.71%2020.28l-26%201.53q-1-6-4.36-8.79t-9.19-2.74q-4.81%200-7.25%202a6.25%206.25%200%200%200-2.44%205%205%205%200%200%200%202%203.85q1.95%201.77%209.27%203.29%2018.12%203.9%2026%207.9t11.4%209.91a25.15%2025.15%200%200%201%203.57%2013.24%2028.35%2028.35%200%200%201-4.75%2015.86%2029.83%2029.83%200%200%201-13.3%2011q-8.55%203.75-21.54%203.75-22.81%200-31.6-8.78T0%20167.56zm163-7.01l24.22%207.32a44.72%2044.72%200%200%201-7.69%2017%2033.46%2033.46%200%200%201-13%2010.31q-7.78%203.47-19.8%203.47-14.58%200-23.82-4.23t-16-14.91q-6.72-10.67-6.71-27.31%200-22.18%2011.8-34.11t33.4-11.92q16.91%200%2026.57%206.84t14.36%2021l-24.4%205.43a21%2021%200%200%200-2.68-6%2016%2016%200%200%200-5.67-4.88%2016.31%2016.31%200%200%200-7.51-1.71q-9.39%200-14.39%207.56-3.8%205.61-3.79%2017.61%200%2014.86%204.52%2020.38t12.69%205.51q7.92%200%2012-4.45t5.9-12.91zm45.51-52.83h27.63V139h30.2v-31.28h27.75v89.43h-27.75V161h-30.2v36.18h-27.63zm102.78%2044.77q0-21.88%2012.2-34.1t34-12.2q22.32%200%2034.4%2012T404%20151.76q0%2015.69-5.28%2025.72a37.54%2037.54%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.12%200-25-4.82a37.59%2037.59%200%200%201-16.07-15.25q-6.26-10.42-6.25-26.11zm27.63.13q0%2013.55%205%2019.46t13.7%205.91q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.1-18.46t-13.82-5.82A16.78%2016.78%200%200%200%20344%20133q-5.07%206-5.08%2019.62z'/%3e%3cpath%20d='M392.28%20152.49q0-21.88%2012.2-34.1t34-12.2q22.34%200%2034.41%2012t12.07%2033.58q0%2015.69-5.27%2025.72a37.6%2037.6%200%200%201-15.25%2015.61q-10%205.58-24.86%205.58-15.13%200-25-4.82a37.67%2037.67%200%200%201-16.08-15.25q-6.22-10.43-6.22-26.12zm27.64.13q0%2013.55%205%2019.46t13.72%205.92q8.91%200%2013.79-5.79t4.88-20.8q0-12.63-5.09-18.46t-13.82-5.82A16.77%2016.77%200%200%200%20425%20133q-5.09%206-5.08%2019.62z'/%3e%3cpath%20d='M482.08%20107.72h27.64v67.41h43.13v22h-70.77z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Q="_header_1izh1_1",Y="_logo_1izh1_9",X="_title_1izh1_17",Z="_link_1izh1_27",_={header:Q,logo:Y,title:X,link:Z},ee=()=>new h({tag:"header",className:_.header},N({href:"/movie-app/",className:_.link},C({className:_.title,txt:"Movie App"})),i({className:_.logo},N({href:"https://rs.school/js/",target:"_blank"},B({src:J,alt:"rs-school-logo"})))),te="_button_1jqyb_1",se={button:te},w=({txt:s,onClick:e,className:t=""})=>new h({tag:"button",className:`${se.button} ${t}`,txt:s,onclick:o=>{o.preventDefault(),e==null||e()}}),oe="_loader_1plmf_1",ne="_spin_1plmf_1",re={loader:oe,spin:ne};class ie extends h{constructor(){super({className:"modal-background"});c(this,"spinner",i());this.append(this.spinner)}show(){this.toggle(!0)}hide(){this.toggle(!1)}toggle(t){this.toggleClass("modal-background",t),this.spinner.toggleClass(re.loader,t)}}const ae=()=>new ie,le="_content_1tfwb_1",ce="_header_1tfwb_20",he="_body_1tfwb_34",de="_footer_1tfwb_42",y={content:le,header:ce,body:he,footer:de};class me extends h{constructor({title:t,description:o,declineText:n,confirmText:r}){super({});c(this,"modalContent");c(this,"modalWrapper");c(this,"resolve");c(this,"onOutsideClick",t=>{t.target===this.modalWrapper.getNode()&&this.setResult(!1)});this.modalWrapper=i({className:"modal-background",onclick:this.onOutsideClick}),this.modalContent=i({className:y.content},i({className:y.header},C({txt:t})),o instanceof h?o:i({className:y.body,txt:o}),i({className:y.footer},w({txt:r??"OK",onClick:()=>{this.setResult(!0)}}),n!=null?w({txt:n,onClick:()=>{this.setResult(!1)}}):null)),this.appendChildren([this.modalContent,this.modalWrapper])}open(t=document.body){return t.append(this.node),new Promise(o=>{this.resolve=o})}setResult(t){var o;(o=this.resolve)==null||o.call(this,t),this.destroy()}}const ue=s=>new me(s),pe="_placeholder_1rug2_1",S={placeholder:pe},L=({src:s,alt:e,className:t=""})=>{const o=new Image,n=i({className:`${S.placeholder} ${t}`},o);return o.src=s,o.alt=e,o.className=t,o.onload=()=>{n.removeClass(S.placeholder)},n},ge="_card_znzpy_1",ve="_poster_znzpy_17",fe="_year_znzpy_23",_e="_genres_znzpy_24",ye="_link_znzpy_25",xe="_title_znzpy_39",g={card:ge,poster:ve,year:fe,genres:_e,link:ye,title:xe},we=({movie:s,onCardClick:e})=>i({className:g.card,onclick:()=>{e()}},L({src:s.posterUrlPreview,alt:"Poster of the movie",className:g.poster}),i({className:g.title,txt:s.nameRu}),i({className:g.year,txt:s.year.toString()}),i({className:g.genres,txt:s.genres.map(({genre:t})=>t).join(", ")})),be=(s,e)=>new h({...s,tag:"i",innerHTML:e}),Ne="_skeleton_ob281_1",Me="_skeleton-loading_ob281_1",Se="_skeleton-text_ob281_13",k={skeleton:Ne,"skeleton-loading":"_skeleton-loading_ob281_1",skeletonLoading:Me,"skeleton-text":"_skeleton-text_ob281_13",skeletonText:Se},ke=()=>i({className:`${k.skeleton} ${k.skeletonText}`});class qe{constructor(){c(this,"observers",[])}subscribe(e){this.observers.push(e)}unsubscribe(e){const t=this.observers.indexOf(e);t!==-1&&this.observers.splice(t,1)}notifyAll(e){for(const t of this.observers)t.update(e)}unsubscribeAll(){this.observers.length=0}}class Ce extends qe{constructor(t){if(t<=0)throw new Error("Timer interval should be greater than 0ms");super();c(this,"intervalId");this.timerInterval=t,this.start()}start(){this.intervalId&&clearInterval(this.intervalId),this.intervalId=window.setInterval(()=>{this.notifyAll(Date.now())},this.timerInterval)}pause(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}stop(){this.pause(),this.unsubscribeAll()}}function Le(s){const e=Math.floor(s/1e3),t=Math.floor(e/60),o=Math.floor(t/60),n=Math.floor(o/24),r=Math.floor(n/30),a=e%60,d=t%60,x=o%24,b=n%30;return`${r} months, ${b} days, ${x} hours, ${d} minutes, ${a} seconds`}const Ie="_timer_6fykf_1",$e={timer:Ie},Pe=1e3;class Oe extends h{constructor(t){super({className:$e.timer},ke());c(this,"timerService",new Ce(Pe));this.premiereDate=t,this.timerService.subscribe(this)}update(t){if(this.premiereDate<=t)this.setTextContent("The premiere has started"),this.timerService.stop();else{const o=Le(this.premiereDate-t);this.setTextContent(o)}}destroy(){this.timerService.stop(),super.destroy()}}const ze=s=>new Oe(s),Ee="_info_gfhxe_1",Ae="_title_gfhxe_14",Fe="_description_gfhxe_24",Te="_poster_gfhxe_29",Re="_row_gfhxe_34",De="_year_gfhxe_40",Be="_genres_gfhxe_41",We="_duration_gfhxe_42",Ke="_countries_gfhxe_43",Ve="_premiere_gfhxe_44",je="_favorite-button_gfhxe_59",He="_favorite-icon_gfhxe_75",Ue="_wait-for-premiere_gfhxe_79",l={info:Ee,title:Ae,description:Fe,poster:Te,row:Re,year:De,genres:Be,duration:We,countries:Ke,premiere:Ve,"favorite-button":"_favorite-button_gfhxe_59",favoriteButton:je,"favorite-icon":"_favorite-icon_gfhxe_75",favoriteIcon:He,"wait-for-premiere":"_wait-for-premiere_gfhxe_79",waitForPremiere:Ue};class Ge extends h{constructor({movie:t,onMakeFavorite:o}){const n=be({className:`${l.favoriteButton} ${t.isFavorite&&l.favoriteIcon}`},"&#x2605;");super({className:l.info},L({src:t.posterUrlPreview,alt:"Poster of the movie",className:l.poster}),i({},D({className:l.waitForPremiere,txt:"Wait for the premiere"}),ze(new Date(t.premiereRu).getTime())),i({className:l.description,txt:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sodales, ligula ornare sodales mattis, tellus lectus porttitor diam, vitae porta mi arcu ac nunc. Nam quam erat, aliquet at sodales id, consectetur a ligula. Mauris ut nunc sodales, efficitur neque eget, euismod massa."}),i({className:l.row},i({txt:"Year"}),i({className:l.year,txt:t.year.toString()})),i({className:l.row},i({txt:"Genres"}),i({className:l.genres,txt:t.genres.map(({genre:r})=>r).join(", ")})),i({className:l.row},i({txt:"Duration"}),i({className:l.duration,txt:`${t.duration}m`})),i({className:l.row},i({txt:"Countries"}),i({className:l.countries,txt:t.countries.map(({country:r})=>r).join(", ")})),i({className:l.row},i({txt:"Premiere"}),i({className:l.premiere,txt:t.premiereRu})),i({className:l.title,onclick:()=>{o(),this.updateFavoriteIcon()}},E({txt:"Add to favorite"}),n));c(this,"favoriteIcon");this.favoriteIcon=n}updateFavoriteIcon(){this.favoriteIcon.toggleClass(l.favoriteIcon)}}const Je=s=>new Ge(s),Qe="_movie-list_xhkah_1",Ye="_movie-list-page_xhkah_8",Xe="_title-container_xhkah_11",Ze="_title_xhkah_11",et="_favorite-switcher_xhkah_22",v={"movie-list":"_movie-list_xhkah_1",movieList:Qe,"movie-list-page":"_movie-list-page_xhkah_8",movieListPage:Ye,"title-container":"_title-container_xhkah_11",titleContainer:Xe,title:Ze,"favorite-switcher":"_favorite-switcher_xhkah_22",favoriteSwitcher:et},q=1,tt=12;class st extends h{constructor(t){super({className:v.movieListPage});c(this,"loader");c(this,"paginationOptions",{page:q,limit:tt});c(this,"movieListContainer");c(this,"loadMoreButton");c(this,"favoriteOnlySwitch");this.movieService=t,this.favoriteOnlySwitch=T({type:"checkbox",id:"favoriteOnly",onchange:()=>{this.paginationOptions.page=q,this.movieListContainer.destroyChildren(),this.loadMovies()}}),this.movieListContainer=i({className:v.movieList}),this.loader=ae(),this.loadMoreButton=w({txt:"Load more",onClick:()=>{this.paginationOptions.page++,this.loadMovies()}}),this.appendChildren([i({className:v.titleContainer},i({className:v.title,txt:"Movies"}),i({className:v.favoriteSwitcher},F({txt:"Favorite only",htmlFor:"favoriteOnly"}),this.favoriteOnlySwitch)),this.movieListContainer,this.loader]),this.loadMovies().then(()=>{this.append(this.loadMoreButton)})}async loadMovies(){this.loader.show(),this.loadMoreButton.addClass("hidden");const t=this.favoriteOnlySwitch.getNode().checked,{data:o,hasMore:n}=await this.movieService.getMovies(this.paginationOptions,t),r=o.map(a=>we({movie:a,onCardClick:()=>{this.showMovieModal(a)}}));requestAnimationFrame(()=>{this.loader.hide(),this.movieListContainer.appendChildren(r),this.loadMoreButton.toggleClass("hidden",!n)})}showMovieModal(t){const o=Je({movie:t,onMakeFavorite:()=>{this.movieService.updateFavoriteMovies(t.kinopoiskId.toString())}});ue({title:t.nameRu,description:o}).open(this.node)}}const ot=s=>new st(s);class nt extends h{constructor(){super({},R({className:"visually-hidden",txt:"Movie App"}),ee(),A({},ot(G)))}}const rt=()=>new nt;class it{constructor(e){this.pageWrapper=e}mount(e){e.append(this.pageWrapper.getNode())}}const I=document.querySelector("#app");if(!I)throw new Error("Root element not found");const at=new it(rt());at.mount(I);
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
